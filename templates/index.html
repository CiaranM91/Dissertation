<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="{{url_for('static', filename='js/p5.js')}}"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script> $SCRIPT_ROOT = '{{ request.script_root|tojson|safe }}'</script>
    <script>

        //loading in JSON of nested list from Python code
        var json = '{{ data }}';
        var board = JSON.parse(json);
        var selectx = null;
        var selecty = null;
        var score = '{{ score }}';
        console.log(score)
        document
        //function to check mouse location and convert to integer within 2d array
        //will return -1 if outside the grid
        function checkClick(mousePosition) {
            if (mousePosition > 7 && mousePosition < 52) {
                return 0;
            } else if (mousePosition > 52 && mousePosition < 97) {
                return 1;
            } else if (mousePosition > 97 && mousePosition < 142) {
                return 2;
            } else if (mousePosition > 142 && mousePosition < 187) {
                return 3;
            } else if (mousePosition > 187 && mousePosition < 232) {
                return 4;
            } else if (mousePosition > 232 && mousePosition < 277) {
                return 5;
            } else if (mousePosition > 277 && mousePosition < 322) {
                return 6;
            } else if (mousePosition > 322 && mousePosition < 350) {
                return 7;
            } else {
                return -1;
            }
        }
    </script>

    <title>Document</title>
</head>

<body>
    <p id="result"></p>
    <script type='application/javascript'>

        function preload() {
            //loading images for grid
            img1 = loadImage("{{url_for('static', filename='images/svg/ambulance.svg')}}");
            img2 = loadImage("{{url_for('static', filename='images/svg/virus.svg')}}");
            img3 = loadImage("{{url_for('static', filename='images/svg/face-mask.svg')}}");
            img4 = loadImage("{{url_for('static', filename='images/svg/lungs.svg')}}");
            img5 = loadImage("{{url_for('static', filename='images/svg/vaccine.svg')}}");
            img6 = loadImage("{{url_for('static', filename='images/svg/skull.svg')}}");
            img7 = loadImage("{{url_for('static', filename='images/svg/cross.svg')}}");

        }

        function setup() {
            //creating canvas
            let cnv = createCanvas(600, 600)
            cnv.id('canvas')
        }

        function draw() {
            console.log()
            var x = 10;
            var y = 10;
            //iterating through 2d array of numbers to form game grid
            for (var i = 0; i < board.length; i++) {

                for (var j = 0; j < board[i].length; j++) {

                    if (board[i][j] == 1) {
                        image(img1, x, y, 30, 30);
                        x += 45;
                    } else if (board[i][j] == 2) {
                        image(img2, x, y, 30, 30);
                        x += 45;
                    } else if (board[i][j] == 3) {
                        image(img3, x, y, 30, 30);
                        x += 45;
                    } else if (board[i][j] == 4) {
                        image(img4, x, y, 30, 30);
                        x += 45;
                    } else if (board[i][j] == 5) {
                        image(img5, x, y, 30, 30);
                        x += 45;
                    } else if (board[i][j] == 6) {
                        image(img6, x, y, 30, 30);
                        x += 45;
                    } else if (board[i][j] == 7) {
                        image(img7, x, y, 30, 30);
                        x += 45;
                    }

                }
                y += 45;
                x = 10;
            }

            if (selectx !=null && selecty != null){
                square((45*selectx), (45*selecty), 55)
            }




        }
        function mouseClicked() {
            $(document).ready(function(){
            $('#canvas').click(function (e) {
            var elm = $(this);
            var xPos = e.pageX - elm.offset().left;
            var yPos = e.pageY - elm.offset().top;
            var i = checkClick(xPos);
            var j = checkClick(yPos);
            var xhttp = new XMLHttpRequest();
			  xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
                    clear();
                    var string = this.responseText;
                    var splitArray = string.split('X');
                    //console.log(splitArray)
                    board = JSON.parse(splitArray[0])
                    
                    if (splitArray[1] == 'None'){
                        selectx = null
                    }else{
                        selectx = splitArray[1];
                    }
                    if(splitArray[2] == 'None'){
                        selecty = null 
                    }else{
                        selecty = splitArray[2];

                    }
                    
                    score = splitArray[3];
                    console.log(selectx)
                    console.log(selecty)
                    console.log(score)
                    
				}
			  };
			  xhttp.open("GET", "/make_selection?i="+i+"&j="+j, true);
              xhttp.send();
              
            
        });
    });

        
        
        }

        

    </script>
  
    <div id='number'>0</div>

</body>

</html>